<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>KML - Renomear por C√≥digo do Endere√ßo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container mt-5">
    <div class="card shadow">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">üîß Editor de KML ‚Äì Renomear Pontos</h4>
      </div>
      <div class="card-body">

        <p><strong>O que este site faz?</strong></p>
        <p>
          Este editor processa um arquivo <code>.kml</code> contendo pontos geogr√°ficos (placemarks) e substitui o conte√∫do da tag <code>&lt;name&gt;</code> de cada ponto com o valor encontrado na descri√ß√£o, mais especificamente o <strong>CODIGO DO ENDERECO</strong> que est√° dentro da tag <code>&lt;description&gt;</code>.
        </p>
        <p>Exemplo de altera√ß√£o:</p>
        <pre>&lt;name&gt;72&lt;/name&gt; ‚ûú &lt;name&gt;831&lt;/name&gt; (baseado no CODIGO DO ENDERECO)</pre>

        <div class="mb-3">
          <label for="fileInput" class="form-label">Selecione um arquivo KML:</label>
          <input class="form-control" type="file" id="fileInput" accept=".kml">
        </div>

        <button class="btn btn-success" onclick="processarKML()">üì• Processar e Baixar Novo KML</button>

        <div class="mt-3">
          <p id="status" class="text-muted"></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    function processarKML() {
      const input = document.getElementById('fileInput');
      const status = document.getElementById('status');

      if (!input.files[0]) {
        status.innerHTML = "<span class='text-danger'>‚ö†Ô∏è Por favor, selecione um arquivo KML.</span>";
        return;
      }

      const file = input.files[0];
      const reader = new FileReader();

      reader.onload = function (e) {
        const parser = new DOMParser();
        const xml = parser.parseFromString(e.target.result, "application/xml");

        const placemarks = xml.getElementsByTagName("Placemark");

        let alterados = 0;

        for (let placemark of placemarks) {
          const desc = placemark.getElementsByTagName("description")[0];
          const name = placemark.getElementsByTagName("name")[0];

          if (desc && name) {
            const match = desc.textContent.match(/CODIGO DO ENDERECO:\s*(\d+)/);
            if (match) {
              name.textContent = match[1];
              alterados++;
            }
          }
        }

        const serializer = new XMLSerializer();
        const kmlString = serializer.serializeToString(xml);

        const blob = new Blob([kmlString], { type: "application/vnd.google-earth.kml+xml" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "kml_modificado.kml";
        a.click();

        status.innerHTML = `‚úÖ <strong>${alterados}</strong> pontos atualizados. O novo arquivo foi gerado e baixado.`;
      };

      reader.readAsText(file);
    }
  </script>

</body>
</html>
